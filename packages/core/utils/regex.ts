/**
 * 内置正则表达式别名
 * 用于表单验证和数据校验
 * 命名规范：小驼峰格式
 */
export const RegexAliases = {
    // ============================================
    // 数字类型
    // ============================================
    /** 正整数（不含0） */
    number: "^\\d+$",
    /** 整数（含负数） */
    integer: "^-?\\d+$",
    /** 浮点数 */
    float: "^-?\\d+(\\.\\d+)?$",
    /** 正整数（不含0） */
    positive: "^[1-9]\\d*$",
    /** 负整数 */
    negative: "^-\\d+$",
    /** 零 */
    zero: "^0$",

    // ============================================
    // 字符串类型
    // ============================================
    /** 纯字母 */
    word: "^[a-zA-Z]+$",
    /** 字母和数字 */
    alphanumeric: "^[a-zA-Z0-9]+$",
    /** 字母、数字和下划线 */
    alphanumeric_: "^[a-zA-Z0-9_]+$",
    /** 字母、数字、下划线和短横线 */
    alphanumericDash_: "^[a-zA-Z0-9_-]+$",
    /** 小写字母 */
    lowercase: "^[a-z]+$",
    /** 大写字母 */
    uppercase: "^[A-Z]+$",

    // ============================================
    // 中文
    // ============================================
    /** 纯中文 */
    chinese: "^[\\u4e00-\\u9fa5]+$",
    /** 中文和字母 */
    chineseWord: "^[\\u4e00-\\u9fa5a-zA-Z]+$",

    // ============================================
    // 常用格式
    // ============================================
    /** 邮箱地址 */
    email: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$",
    /** 中国大陆手机号 */
    phone: "^1[3-9]\\d{9}$",
    /** 固定电话（区号-号码） */
    telephone: "^0\\d{2,3}-?\\d{7,8}$",
    /** URL 地址 */
    url: "^https?://",
    /** IPv4 地址 */
    ip: "^((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$",
    /** IPv6 地址 */
    ipv6: "^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$",
    /** 域名 */
    domain: "^(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\\.)+[a-zA-Z]{2,}$",

    // ============================================
    // 特殊格式
    // ============================================
    /** UUID */
    uuid: "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
    /** 十六进制字符串 */
    hex: "^[0-9a-fA-F]+$",
    /** Base64 编码 */
    base64: "^[A-Za-z0-9+/=]+$",
    /** MD5 哈希 */
    md5: "^[a-f0-9]{32}$",
    /** SHA1 哈希 */
    sha1: "^[a-f0-9]{40}$",
    /** SHA256 哈希 */
    sha256: "^[a-f0-9]{64}$",

    // ============================================
    // 日期时间
    // ============================================
    /** 日期 YYYY-MM-DD */
    date: "^\\d{4}-\\d{2}-\\d{2}$",
    /** 时间 HH:MM:SS */
    time: "^\\d{2}:\\d{2}:\\d{2}$",
    /** ISO 日期时间 */
    datetime: "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}",
    /** 年份 */
    year: "^\\d{4}$",
    /** 月份 01-12 */
    month: "^(0[1-9]|1[0-2])$",
    /** 日期 01-31 */
    day: "^(0[1-9]|[12]\\d|3[01])$",

    // ============================================
    // 代码相关
    // ============================================
    /** 变量名 */
    variable: "^[a-zA-Z_][a-zA-Z0-9_]*$",
    /** 常量名（全大写） */
    constant: "^[A-Z][A-Z0-9_]*$",
    /** 包名（小写+连字符） */
    package: "^[a-z][a-z0-9-]*$",

    // ============================================
    // 证件相关
    // ============================================
    /** 中国身份证号（18位） */
    idCard: "^\\d{17}[\\dXx]$",
    /** 护照号 */
    passport: "^[a-zA-Z0-9]{5,17}$",

    // ============================================
    // 账号相关（国内常用）
    // ============================================
    /** 银行卡号（16-19位数字） */
    bankCard: "^\\d{16,19}$",
    /** 微信号（6-20位，字母开头，可包含字母、数字、下划线、减号） */
    wechat: "^[a-zA-Z][a-zA-Z0-9_-]{5,19}$",
    /** QQ号（5-11位数字，首位非0） */
    qq: "^[1-9]\\d{4,10}$",
    /** 支付宝账号（手机号或邮箱） */
    alipay: "^(1[3-9]\\d{9}|[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,})$",
    /** 用户名（4-20位，字母开头，可包含字母、数字、下划线） */
    username: "^[a-zA-Z][a-zA-Z0-9_]{3,19}$",
    /** 昵称（2-20位，支持中文、字母、数字） */
    nickname: "^[\\u4e00-\\u9fa5a-zA-Z0-9]{2,20}$",

    // ============================================
    // 密码强度
    // ============================================
    /** 弱密码（至少6位） */
    passwordWeak: "^.{6,}$",
    /** 中等密码（至少8位，包含字母和数字） */
    passwordMedium: "^(?=.*[a-zA-Z])(?=.*\\d).{8,}$",
    /** 强密码（至少8位，包含大小写字母、数字和特殊字符） */
    passwordStrong: "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[!@#$%^&*]).{8,}$",

    // ============================================
    // 其他常用
    // ============================================
    /** 车牌号（新能源+普通） */
    licensePlate: "^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领][A-Z][A-HJ-NP-Z0-9]{4,5}[A-HJ-NP-Z0-9挂学警港澳]$",
    /** 邮政编码 */
    postalCode: "^\\d{6}$",
    /** 版本号（语义化版本） */
    semver: "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?(\\+[a-zA-Z0-9.]+)?$",
    /** 颜色值（十六进制） */
    colorHex: "^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$",

    // ============================================
    // 空值
    // ============================================
    /** 空字符串 */
    empty: "^$",
    /** 非空 */
    notempty: ".+"
} as const;

/**
 * 正则别名类型
 */
export type RegexAliasName = keyof typeof RegexAliases;

// ============================================
// 正则表达式缓存（性能优化）
// ============================================
const regexCache = new Map<string, RegExp>();

/**
 * 获取正则表达式字符串
 * @param name 正则别名（以 @ 开头）或自定义正则字符串
 * @returns 正则表达式字符串
 */
export function getRegex(name: string): string {
    if (name.startsWith("@")) {
        const alias = name.slice(1) as RegexAliasName;
        return RegexAliases[alias] || name;
    }
    return name;
}

/**
 * 获取编译后的正则表达式对象（带缓存）
 * @param pattern 正则别名或正则字符串
 * @param flags 正则标志（如 'i', 'g'）
 * @returns 编译后的 RegExp 对象
 */
export function getCompiledRegex(pattern: string, flags?: string): RegExp {
    const regexStr = getRegex(pattern);
    const cacheKey = `${regexStr}:${flags || ""}`;

    let cached = regexCache.get(cacheKey);
    if (!cached) {
        cached = new RegExp(regexStr, flags);
        regexCache.set(cacheKey, cached);
    }
    return cached;
}

/**
 * 验证值是否匹配正则（使用缓存）
 * @param value 要验证的值
 * @param pattern 正则别名或正则字符串
 * @returns 是否匹配
 */
export function matchRegex(value: string, pattern: string): boolean {
    return getCompiledRegex(pattern).test(value);
}

/**
 * 清除正则缓存
 */
export function clearRegexCache(): void {
    regexCache.clear();
}

/**
 * 获取缓存大小
 */
export function getRegexCacheSize(): number {
    return regexCache.size;
}
