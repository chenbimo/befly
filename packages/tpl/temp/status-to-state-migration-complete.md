# Status â†’ State å­—æ®µè¿ç§»å®ŒæˆæŠ¥å‘Š

**æ—¥æœŸ**ï¼š2025-10-19
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

## ğŸ“‹ èƒŒæ™¯

ç”¨æˆ·æŒ‡å‡ºé¡¹ç›®ä¸­è‡ªå®šä¹‰çš„ `status` å­—æ®µä¸æ¡†æ¶ä¿ç•™çš„ `state` å­—æ®µåŠŸèƒ½é‡å¤ï¼Œè¿åäº†æ¡†æ¶è®¾è®¡è§„èŒƒã€‚æ¡†æ¶å·²æä¾›ç»Ÿä¸€çš„ `state` å­—æ®µæ¥ç®¡ç†æ‰€æœ‰è®°å½•çŠ¶æ€ï¼š

- `state = 0`ï¼šå·²åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰
- `state = 1`ï¼šæ­£å¸¸/æ¿€æ´»ï¼ˆé»˜è®¤ï¼‰
- `state = 2`ï¼šå·²ç¦ç”¨

## ğŸ¯ è¿ç§»ç›®æ ‡

1. åˆ é™¤æ‰€æœ‰è¡¨å®šä¹‰ä¸­çš„è‡ªå®šä¹‰ `status` å­—æ®µ
2. æ›´æ–°æ‰€æœ‰ API ä»£ç ï¼Œç§»é™¤ `status` å­—æ®µçš„å¼•ç”¨
3. ç»Ÿä¸€ä½¿ç”¨æ¡†æ¶çš„ `state` å­—æ®µè¿›è¡ŒçŠ¶æ€ç®¡ç†
4. æ›´æ–°ç±»å‹å®šä¹‰å’Œæ³¨é‡Šè¯´æ˜

## âœ… å®Œæˆçš„ä¿®æ”¹

### 1. è¡¨å®šä¹‰æ–‡ä»¶ï¼ˆå·²åœ¨ä¹‹å‰å®Œæˆï¼‰

| æ–‡ä»¶                | ä¿®æ”¹å†…å®¹                  |
| ------------------- | ------------------------- |
| `tables/menu.json`  | âœ… åˆ é™¤ `status` å­—æ®µå®šä¹‰ |
| `tables/role.json`  | âœ… åˆ é™¤ `status` å­—æ®µå®šä¹‰ |
| `tables/admin.json` | âœ… åˆ é™¤ `status` å­—æ®µå®šä¹‰ |

### 2. è„šæœ¬æ–‡ä»¶

| æ–‡ä»¶                  | ä¿®æ”¹å†…å®¹                                                                  |
| --------------------- | ------------------------------------------------------------------------- |
| `scripts/syncMenu.ts` | âœ… ç§»é™¤ `status` å­—æ®µæ“ä½œ<br>âœ… æ›´æ–°æ³¨é‡Šè¯´æ˜<br>âœ… æŸ¥è¯¢å’Œç¼“å­˜æ”¹ç”¨ `state` |
| `scripts/syncDev.ts`  | âœ… ç§»é™¤ `status: 1` èµ‹å€¼                                                  |

### 3. API æ–‡ä»¶ï¼ˆæœ¬æ¬¡å®Œæˆï¼‰

| æ–‡ä»¶                 | ä¿®æ”¹å†…å®¹                                                                                                            |
| -------------------- | ------------------------------------------------------------------------------------------------------------------- |
| `apis/menuCreate.ts` | âœ… ç§»é™¤ `status: adminMenuTable.status`<br>âœ… æ·»åŠ æ³¨é‡Šè¯´æ˜ state è‡ªåŠ¨ç®¡ç†                                           |
| `apis/menuUpdate.ts` | âœ… ç§»é™¤ `status` å­—æ®µéªŒè¯<br>âœ… ç§»é™¤ `status: ctx.body.status` æ›´æ–°<br>âœ… æ·»åŠ æ³¨é‡Šè¯´æ˜ç¦ç”¨/å¯ç”¨ç”¨æ³•                 |
| `apis/menuList.ts`   | âœ… å°† fields ä¸­çš„ `'status'` æ”¹ä¸º `'state'`                                                                         |
| `apis/roleCreate.ts` | âœ… ç§»é™¤ `status: adminRoleTable.status`<br>âœ… ç§»é™¤ `status: ctx.body.status` æ’å…¥<br>âœ… æ·»åŠ æ³¨é‡Šè¯´æ˜ state è‡ªåŠ¨ç®¡ç† |
| `apis/roleUpdate.ts` | âœ… ç§»é™¤ `status` å­—æ®µéªŒè¯<br>âœ… ç§»é™¤ `status: ctx.body.status` æ›´æ–°<br>âœ… æ·»åŠ æ³¨é‡Šè¯´æ˜ç¦ç”¨/å¯ç”¨ç”¨æ³•                 |
| `apis/login.ts`      | âœ… æ”¹ä¸ºæ£€æŸ¥ `state === 2`ï¼ˆå·²åœ¨ä¹‹å‰å®Œæˆï¼‰                                                                           |
| `apis/register.ts`   | âœ… ç§»é™¤ `status: 1` èµ‹å€¼ï¼ˆå·²åœ¨ä¹‹å‰å®Œæˆï¼‰                                                                            |
| `apis/adminMenus.ts` | âœ… ç§»é™¤ `status` æŸ¥è¯¢ï¼ˆå·²åœ¨ä¹‹å‰å®Œæˆï¼‰                                                                               |
| `apis/adminInfo.ts`  | âœ… æ›´æ–°æ³¨é‡Šï¼Œå°† `status` æ”¹ä¸º `state`                                                                               |

### 4. ç±»å‹å®šä¹‰

| æ–‡ä»¶             | ä¿®æ”¹å†…å®¹                                                                              |
| ---------------- | ------------------------------------------------------------------------------------- |
| `types/index.ts` | âœ… Admin æ¥å£ï¼š`status: 0 \| 1` â†’ `state: 0 \| 1 \| 2`<br>âœ… æ·»åŠ æ³¨é‡Šè¯´æ˜å„çŠ¶æ€å€¼å«ä¹‰ |

## ğŸ” éªŒè¯ç»“æœ

ä½¿ç”¨ `grep` æœç´¢ç¡®è®¤æ‰€æœ‰ `status` å¼•ç”¨å·²æ¸…ç†ï¼š

```bash
grep -r "status" packages/tpl/addons/admin/**/*.ts
# ç»“æœï¼šNo matches found âœ…
```

## ğŸ“Š è¿ç§»ç»Ÿè®¡

- **ä¿®æ”¹æ–‡ä»¶æ€»æ•°**ï¼š13 ä¸ª
- **åˆ é™¤å­—æ®µå®šä¹‰**ï¼š3 ä¸ªè¡¨
- **æ›´æ–° API æ¥å£**ï¼š9 ä¸ª
- **æ›´æ–°è„šæœ¬æ–‡ä»¶**ï¼š2 ä¸ª
- **æ›´æ–°ç±»å‹å®šä¹‰**ï¼š1 ä¸ª

## ğŸ“ å…³é”®è¦ç‚¹

### 1. æ¡†æ¶è‡ªåŠ¨ç®¡ç†çš„å­—æ®µ

ä»¥ä¸‹å­—æ®µç”±æ¡†æ¶è‡ªåŠ¨æ·»åŠ å’Œç®¡ç†ï¼Œ**ç¦æ­¢**åœ¨è¡¨å®šä¹‰ JSON ä¸­å£°æ˜ï¼š

- `id` - ä¸»é”® IDï¼ˆç”± Redis `genTimeID()` ç”Ÿæˆï¼‰
- `created_at` - åˆ›å»ºæ—¶é—´æˆ³
- `updated_at` - æ›´æ–°æ—¶é—´æˆ³
- `deleted_at` - åˆ é™¤æ—¶é—´æˆ³ï¼ˆè½¯åˆ é™¤ï¼‰
- `state` - çŠ¶æ€å­—æ®µï¼ˆ0/1/2ï¼‰

### 2. State å­—æ®µä½¿ç”¨è§„èŒƒ

```typescript
// âœ… æ­£å¸¸è®°å½•ï¼ˆé»˜è®¤ï¼‰
await befly.db.insData({
    table: 'addon_admin_menu',
    data: { name: 'èœå•å' }
    // state è‡ªåŠ¨è®¾ç½®ä¸º 1
});

// âœ… ç¦ç”¨è®°å½•
await befly.db.updData({
    table: 'addon_admin_menu',
    where: { id: menuId },
    data: { state: 2 } // æ‰‹åŠ¨è®¾ç½®ä¸ºç¦ç”¨
});

// âœ… å¯ç”¨è®°å½•
await befly.db.updData({
    table: 'addon_admin_menu',
    where: { id: menuId },
    data: { state: 1 } // æ¢å¤ä¸ºæ­£å¸¸
});

// âœ… è½¯åˆ é™¤
await befly.db.delData({
    table: 'addon_admin_menu',
    where: { id: menuId }
    // è‡ªåŠ¨è®¾ç½® state=0, deleted_at=å½“å‰æ—¶é—´
});

// âœ… æŸ¥è¯¢æ—¶è‡ªåŠ¨è¿‡æ»¤å·²åˆ é™¤è®°å½•
const menus = await befly.db.getAll({
    table: 'addon_admin_menu'
    // è‡ªåŠ¨æ·»åŠ  where: { state$gt: 0 }
});
```

### 3. ç¦æ­¢äº‹é¡¹

âŒ **ç¦æ­¢åœ¨è¡¨ JSON ä¸­å®šä¹‰ state å­—æ®µ**ï¼š

```json
// âŒ é”™è¯¯
{
    "status": "çŠ¶æ€|number|0|1|1|1|null",
    "state": "çŠ¶æ€|number|0|2|1|1|null"
}

// âœ… æ­£ç¡®ï¼šä¸å®šä¹‰ä»»ä½•çŠ¶æ€å­—æ®µï¼Œç”±æ¡†æ¶è‡ªåŠ¨æ·»åŠ 
{
    "name": "åç§°|string|2|50|null|1|null"
}
```

âŒ **ç¦æ­¢æ‰‹åŠ¨è®¾ç½® state=0**ï¼š

```typescript
// âŒ é”™è¯¯ï¼šä¸è¦æ‰‹åŠ¨è®¾ç½® state=0
await befly.db.updData({
    table: 'addon_admin_menu',
    where: { id: menuId },
    data: { state: 0 }
});

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ delData æ–¹æ³•
await befly.db.delData({
    table: 'addon_admin_menu',
    where: { id: menuId }
});
```

## ğŸš€ åç»­å»ºè®®

1. **ç»Ÿä¸€çŠ¶æ€ç®¡ç†**ï¼šæ‰€æœ‰ addon å’Œä¸šåŠ¡è¡¨éƒ½åº”éµå¾ª state å­—æ®µè§„èŒƒ
2. **æ–‡æ¡£æ›´æ–°**ï¼šæ›´æ–° AGENTS.mdï¼Œæ˜ç¡®ç¦æ­¢è‡ªå®šä¹‰çŠ¶æ€å­—æ®µ
3. **ä»£ç å®¡æŸ¥**ï¼šå®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„è‡ªå®šä¹‰çŠ¶æ€å­—æ®µ
4. **å‰ç«¯é€‚é…**ï¼šå‰ç«¯ç»„ä»¶éœ€è¦é€‚é… state å­—æ®µï¼ˆ0/1/2ï¼‰è€Œéæ—§çš„ status å­—æ®µ

## ğŸ“ å‚è€ƒèµ„æ–™

- æ¡†æ¶è§„èŒƒï¼š`core/docs/` ç›®å½•
- è¿ç§»æŒ‡å—ï¼š`temp/remove-status-field.md`
- æ€»æŒ‡ä»¤æ–‡ä»¶ï¼š`AGENTS.md`

---

**è¿ç§»è´Ÿè´£äºº**ï¼šAI Assistant
**å®¡æ ¸çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ
**æœ€åæ›´æ–°**ï¼š2025-10-19
