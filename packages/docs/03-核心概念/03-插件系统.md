# 插件系统

插件位于：

-   核心：`core/plugins/*.js`
-   应用：`<project>/plugins/*.js`

## 生命周期与排序

-   通过 `after: ['otherPlugin']` 指定依赖顺序。
-   启动时，核心与应用插件分别扫描与拓扑排序；冲突或失败会导致进程退出。

## 钩子

-   `onInit(appContext)`：初始化插件，返回的对象会挂载到 `appContext[pluginName]`。
-   `onGet(appContext, ctx, req)`：每次请求进入 `/api/*` 前置执行（可做注入、灰度、限流等）。

## 示例：数据库插件

-   当 `Env.DB_ENABLE===1` 时：通过 `createSqlClient()` 创建连接池，构造 `SqlHelper` 实例并返回。
-   失败会记录错误并抛出，主流程会统一退出防止服务处于半失效状态。

## 用户插件覆盖策略

-   同名时优先核心插件；应用侧若想覆盖，建议使用不同名称并在文档中说明依赖顺序与职责边界。
