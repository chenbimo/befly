# 数据库读写示例

当 `Env.DB_ENABLE=1` 且 DB\_\* 配置正确时，数据库插件会注入 `befly.db`（`SqlHelper` 实例）。

## 读取单条

```js
const user = await befly.db.getDetail('users', { id: 1 });
```

## 分页列表

```js
const list = await befly.db.getList('users', {
    where: { status: 1 },
    orderBy: ['created_at#DESC'],
    page: 1,
    pageSize: 10
});
```

## 插入/更新/删除

```js
await befly.db.insData('users', { name: 'Tom', email: 't@ex.com' });
await befly.db.updData('users', { name: 'Tom2' }, { id: 1 });
await befly.db.delData2('users', { id: 1 }); // 软删除
```

## 事务

```js
await befly.db.trans(async (tx) => {
    const u = await tx.getDetail('users', { id: 1 });
    if (!u) await tx.insData('users', { id: 1, name: 'new' });
});
```

更多完整能力（字段/表名自动转义、复杂 where、leftJoin、构造器等），请参考：`core/docs/curd.md`。

## 示例

-   查询构造器：

```js
const { sql, params } = befly.db.query().select(['id', 'name']).from('users').where({ status: 1 }).limit(10).toSelectSql();
const rows = await befly.db.execute(sql, params);
```

-   分页接口调用建议：

```
curl "http://127.0.0.1:3000/api/app/users/list?page=1&pageSize=10"
```
