# Lefthook 配置文件
# 文档: https://lefthook.dev/

pre-commit:
    jobs:
        # 1. 格式化代码（统一使用 oxfmt）
        - name: Format files (oxfmt)
          priority: 1
          glob: "*.{js,jsx,mjs,cjs,ts,tsx,mts,cts,json,jsonc,json5,yml,yaml,toml,html,vue,mjml,hbs,handlebars,graphql,gql,md,mdx,css,scss,less}"
          run: oxfmt -c ./.oxfmtrc.jsonc --no-error-on-unmatched-pattern {staged_files}

        # 2. Oxlint 代码检查（门禁）
        - name: Gate - lint
          priority: 2
          run: bun run gate:lint

        # 3. TypeScript 语法检查 (core)
        - name: Gate - typecheck (core)
          priority: 2
          run: bun run gate:typecheck

        # 4. 运行测试
        - name: Gate - test
          priority: 3
          run: bun run gate:test:bail
