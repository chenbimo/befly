#!/usr/bin/env sh
# Git pre-commit hook - 自动格式化暂存的文件

echo "正在检查暂存文件..."

# 获取所有暂存的文件（只包括添加和修改的文件）
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|ts|jsx|tsx|vue|json|md|yaml|yml|css|scss|less|html)$')

if [ -z "$STAGED_FILES" ]; then
    echo "没有需要格式化的文件"
    exit 0
fi

echo "正在格式化以下文件:"
echo "$STAGED_FILES"

# 将文件列表转换为数组并逐个格式化
echo "$STAGED_FILES" | while IFS= read -r file; do
    if [ -f "$file" ]; then
        bunx prettier --write "$file"
        git add "$file"
    fi
done

echo "✓ 代码格式化完成"
exit 0
